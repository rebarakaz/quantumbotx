# AI Mentor Reports Table

<cite>
**Referenced Files in This Document**   
- [models.py](file://core/db/models.py#L176-L199)
- [init_db.py](file://init_db.py#L118-L128)
- [ai_mentor.py](file://core/routes/ai_mentor.py#L98-L137)
- [trading_mentor_ai.py](file://core/ai/trading_mentor_ai.py#L238-L304)
</cite>

## Table of Contents
1. [Introduction](#introduction)
2. [Table Purpose and Overview](#table-purpose-and-overview)
3. [Database Schema and Fields](#database-schema-and-fields)
4. [Relationship with Trading Sessions](#relationship-with-trading-sessions)
5. [Report Generation Process](#report-generation-process)
6. [Data Flow and Storage Lifecycle](#data-flow-and-storage-lifecycle)
7. [Usage Examples](#usage-examples)
8. [Integration with Web Interface](#integration-with-web-interface)

## Introduction
The `ai_mentor_reports` table is a core component of the AI Mentor system, designed to store personalized trading analysis and feedback for users. This documentation provides a comprehensive overview of the table's structure, purpose, and integration within the QuantumBotX trading platform. The AI Mentor system functions as a digital coach, providing emotional support, risk assessment, and strategic recommendations to traders, particularly beginners in the Indonesian market.

## Table Purpose and Overview
The `ai_mentor_reports` table stores comprehensive daily analysis reports generated by the AI Mentor system. These reports are designed to emulate the guidance of a human trading mentor, providing personalized feedback on trading performance, emotional state, risk management, and strategic recommendations. The primary purpose of this table is to:

- Store structured AI-generated analysis of daily trading sessions
- Provide historical record of mentorship and user progress
- Enable retrieval of motivational messages and performance insights
- Support the dashboard and reporting interface for users
- Facilitate longitudinal analysis of trading behavior and improvement

The AI Mentor system specifically targets Indonesian traders, incorporating cultural context and language (Bahasa Indonesia) to provide relatable and supportive guidance. The reports aim to address both the technical aspects of trading and the psychological challenges faced by beginners.

**Section sources**
- [models.py](file://core/db/models.py#L176-L199)
- [init_db.py](file://init_db.py#L118-L128)

## Database Schema and Fields
The `ai_mentor_reports` table is defined with the following schema, as specified in the database initialization script:

```sql
CREATE TABLE IF NOT EXISTS ai_mentor_reports (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    session_id INTEGER NOT NULL,
    trading_patterns_analysis TEXT,
    emotional_analysis TEXT,
    risk_management_score INTEGER,
    recommendations TEXT,
    motivation_message TEXT,
    language TEXT DEFAULT 'bahasa_indonesia',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (session_id) REFERENCES trading_sessions (id) ON DELETE CASCADE
);
```

### Field Descriptions
**id**: Primary key identifier for the report record. Auto-incremented by the database.

**session_id**: Foreign key reference to the `trading_sessions` table. This establishes the one-to-one relationship between a trading session and its corresponding AI mentor report. The foreign key constraint ensures referential integrity with cascade delete.

**trading_patterns_analysis**: JSON-formatted text field storing the analysis of trading patterns detected during the session. Contains structured data about the main trading pattern, analysis, strengths, and areas for improvement. This field is populated with a JSON dump of the `pola_trading` dictionary from the AI analysis.

**emotional_analysis**: JSON-formatted text field containing the analysis of emotional impact on trading performance. Includes feedback and tips specific to the trader's emotional state (e.g., calm, greedy, fearful, frustrated). This field stores the `emosi_vs_performa` dictionary as JSON.

**risk_management_score**: Integer field representing the risk management evaluation score. The score ranges from 1-10 and is derived from the `manajemen_risiko` dictionary's `nilai` field. This provides a quantifiable measure of the trader's risk discipline.

**recommendations**: JSON-formatted text field containing a list of actionable recommendations for the trader. Includes both performance-based suggestions and general tips for Indonesian traders. This field stores the `rekomendasi` list as JSON.

**motivation_message**: Text field containing a personalized motivational message in Bahasa Indonesia. The message is designed to support and encourage the trader, with content varying based on their daily performance (profit/loss amount). This field directly stores the `motivasi` string from the AI analysis.

**language**: Text field specifying the language of the report. Defaults to 'bahasa_indonesia' to maintain consistency with the target user base.

**created_at**: Timestamp field automatically set to the current date and time when the report is created. This enables chronological sorting and historical analysis of mentorship data.

**Section sources**
- [init_db.py](file://init_db.py#L118-L128)
- [models.py](file://core/db/models.py#L176-L199)

## Relationship with Trading Sessions
The `ai_mentor_reports` table is intrinsically linked to the `trading_sessions` table through a one-to-one relationship. This relationship is fundamental to the AI Mentor system's functionality, as reports are generated for specific trading sessions.

``mermaid
erDiagram
trading_sessions {
INTEGER id PK
DATE session_date
INTEGER total_trades
REAL total_profit_loss
TEXT emotions
TEXT market_conditions
TEXT personal_notes
INTEGER risk_score
DATETIME created_at
}
ai_mentor_reports {
INTEGER id PK
INTEGER session_id FK
TEXT trading_patterns_analysis
TEXT emotional_analysis
INTEGER risk_management_score
TEXT recommendations
TEXT motivation_message
TEXT language
DATETIME created_at
}
trading_sessions ||--|| ai_mentor_reports : "one-to-one"
```

**Diagram sources**
- [init_db.py](file://init_db.py#L118-L128)
- [models.py](file://core/db/models.py#L33-L64)

### Relationship Mechanics
The relationship operates through the `session_id` foreign key in the `ai_mentor_reports` table, which references the `id` field in the `trading_sessions` table. This design ensures that each trading session can have at most one AI mentor report, maintaining data integrity and logical consistency.

The relationship is established through several key functions in the `models.py` file:

1. **Session Creation**: The `create_trading_session()` function initializes a new trading session, which serves as the foundation for future AI analysis.

2. **Session Retrieval**: The `get_or_create_today_session()` function ensures that a session exists for the current day, creating one if necessary before generating a report.

3. **Data Aggregation**: The `get_trading_session_data()` function compiles all relevant trading data for a specific date, including trades from the `daily_trading_data` table, which is then used as input for the AI analysis.

4. **Report Storage**: The `save_ai_mentor_report()` function takes the AI analysis and associates it with the appropriate session via the `session_id`.

The foreign key constraint with `ON DELETE CASCADE` ensures that when a trading session is deleted, its corresponding AI mentor report is automatically removed, preventing orphaned records and maintaining database consistency.

**Section sources**
- [models.py](file://core/db/models.py#L33-L64)
- [models.py](file://core/db/models.py#L93-L153)

## Report Generation Process
The AI mentor report generation process is a multi-step workflow that transforms raw trading data into personalized, human-readable feedback. This process involves data collection, AI analysis, and report formatting.

``mermaid
sequenceDiagram
participant User as "Trader"
participant Web as "Web Interface"
participant Route as "ai_mentor.py"
participant Model as "models.py"
participant AI as "trading_mentor_ai.py"
User->>Web : Requests Today's Report
Web->>Route : GET /ai-mentor/today-report
Route->>Model : get_trading_session_data(today)
Model->>Model : Query trading_sessions and daily_trading_data
Model-->>Route : Session data dictionary
Route->>AI : mentor.analyze_trading_session(session)
AI->>AI : _detect_trading_patterns()
AI->>AI : _analyze_emotional_impact()
AI->>AI : _evaluate_risk_management()
AI->>AI : _generate_recommendations()
AI->>AI : _create_motivation_message()
AI-->>Route : Complete analysis dictionary
Route->>Model : save_ai_mentor_report(session_id, analysis)
Model->>Model : INSERT INTO ai_mentor_reports
Model-->>Route : Success status
Route->>Web : Render daily_report.html
Web->>User : Display formatted AI report
```

**Diagram sources**
- [ai_mentor.py](file://core/routes/ai_mentor.py#L98-L137)
- [trading_mentor_ai.py](file://core/ai/trading_mentor_ai.py#L21-L304)
- [models.py](file://core/db/models.py#L176-L199)

### Step-by-Step Generation Workflow
1. **User Request**: The process begins when a user requests their daily report through the web interface, typically by visiting the `/ai-mentor/today-report` endpoint.

2. **Session Data Retrieval**: The route handler calls `get_trading_session_data()` to retrieve all relevant information for the current trading session, including trades, emotions, market conditions, and profit/loss data.

3. **AI Analysis**: The retrieved session data is converted into a `TradingSession` object and passed to the `IndonesianTradingMentorAI.analyze_trading_session()` method, which orchestrates the analysis through several specialized methods:
   - `_detect_trading_patterns()`: Identifies the main trading pattern based on profitability
   - `_analyze_emotional_impact()`: Evaluates how the trader's emotional state affected performance
   - `_evaluate_risk_management()`: Assesses risk management practices and calculates a score
   - `_generate_recommendations()`: Creates actionable tips based on performance
   - `_create_motivation_message()`: Generates an encouraging message tailored to the day's results

4. **Report Storage**: The complete analysis dictionary is passed to `save_ai_mentor_report()`, which extracts the relevant fields and inserts them into the `ai_mentor_reports` table.

5. **Report Formatting**: The AI analysis is used to generate a formatted daily report via `generate_daily_report()`, which structures the information in a visually appealing format with emojis and clear sections.

6. **User Presentation**: The formatted report is rendered in the `daily_report.html` template and displayed to the user.

This process ensures that users receive timely, personalized feedback that helps them improve their trading skills while maintaining emotional well-being.

**Section sources**
- [ai_mentor.py](file://core/routes/ai_mentor.py#L98-L137)
- [trading_mentor_ai.py](file://core/ai/trading_mentor_ai.py#L21-L304)

## Data Flow and Storage Lifecycle
The data flow for AI mentor reports follows a structured lifecycle from data collection to final presentation. This lifecycle ensures that trading data is properly captured, analyzed, stored, and made available for user review.

``mermaid
flowchart TD
A[Trade Execution] --> B[Log Trade Data]
B --> C[Daily Trading Data Table]
C --> D{End of Trading Day?}
D --> |Yes| E[Retrieve Session Data]
D --> |No| F[Continue Trading]
E --> G[Generate AI Analysis]
G --> H[Format Report Content]
H --> I[Store in ai_mentor_reports]
I --> J[Display to User]
J --> K[Historical Access]
K --> L[Data Retention Policy]
```

**Diagram sources**
- [models.py](file://core/db/models.py#L66-L91)
- [models.py](file://core/db/models.py#L176-L199)
- [ai_mentor.py](file://core/routes/ai_mentor.py#L98-L137)

### Lifecycle Stages
**Data Collection**: Trading data is collected throughout the day via the `log_trade_for_ai_analysis()` function, which records individual trades in the `daily_trading_data` table. This function is called after each trade execution, capturing details such as symbol, profit/loss, lot size, and risk parameters.

**Session Aggregation**: At the end of the trading day (or when a report is requested), the `get_trading_session_data()` function aggregates all trades associated with the current session. This function also retrieves session metadata such as emotions, market conditions, and personal notes.

**AI Processing**: The aggregated session data is processed by the `IndonesianTradingMentorAI` class, which applies its analysis methods to generate insights across multiple dimensions: trading patterns, emotional impact, risk management, and recommendations.

**Storage**: The AI analysis results are stored in the `ai_mentor_reports` table through the `save_ai_mentor_report()` function. This function maps the analysis dictionary to the appropriate database fields, converting complex data structures to JSON strings for storage.

**Retrieval and Presentation**: Reports are retrieved through various functions depending on the use case:
- `get_recent_mentor_reports()` for dashboard summaries
- Direct queries for specific session reports
- The web interface routes that render reports in HTML templates

**Historical Access**: Users can access past reports through the AI mentor history interface, allowing them to track their progress over time and identify patterns in their trading behavior.

The lifecycle is designed to be both comprehensive and efficient, ensuring that valuable trading insights are captured and preserved while maintaining system performance.

**Section sources**
- [models.py](file://core/db/models.py#L66-L91)
- [models.py](file://core/db/models.py#L176-L199)
- [ai_mentor.py](file://core/routes/ai_mentor.py#L139-L155)

## Usage Examples
The `ai_mentor_reports` table is utilized in several key scenarios within the QuantumBotX platform. These examples demonstrate how the table supports different aspects of the AI mentor functionality.

### Example 1: Successful Trading Day
When a user has a profitable trading day, the AI mentor generates a positive report that reinforces good practices. For a session with $77.70 profit, the stored data might look like:

```json
{
  "session_id": 123,
  "trading_patterns_analysis": {
    "pola_utama": "Trading Disiplin",
    "analisis": "Bagus! Anda berhasil profit $77.70 hari ini. Saya melihat Anda mengikuti aturan dengan baik.",
    "kekuatan": "Konsisten dengan strategi yang dipilih",
    "area_perbaikan": "Pertahankan kedisiplinan ini"
  },
  "emotional_analysis": {
    "feedback": "Luar biasa! Emosi yang tenang menghasilkan keputusan trading yang objektif.",
    "tip": "Pertahankan ketenangan ini. Ini adalah kunci trader profesional."
  },
  "risk_management_score": 9,
  "recommendations": [
    "💡 **Tips Hari Ini:**",
    "- Profit bagus! Jangan serakah, ambil sebagian profit untuk disyukuri.",
    "- Pertahankan strategi yang sama, jangan ganti-ganti.",
    "- Dokumentasikan apa yang membuat Anda sukses hari ini."
  ],
  "motivation_message": "Luar biasa! Anda sudah menunjukkan potensi trader yang hebat! 🚀\n\n🎯 **Ingat Journey Anda:** Dari awalnya ikut mentor yang hilang kontak, sekarang Anda sudah bisa trading mandiri dengan sistem sendiri!"
}
```

This data is then formatted into a comprehensive report that celebrates the user's success while encouraging continued discipline.

### Example 2: Learning-Oriented Day with Losses
For a trading session with losses, the AI mentor adopts a supportive, educational tone. For a session with -$41.10 loss, the stored data might include:

```json
{
  "session_id": 124,
  "trading_patterns_analysis": {
    "pola_utama": "Pembelajaran Berlanjutan",
    "analisis": "Loss $41.10 adalah bagian dari belajar. Yang penting adalah kita belajar dari kesalahan.",
    "kekuatan": "Berani mengambil risiko untuk belajar",
    "area_perbaikan": "Mari analisis apa yang bisa diperbaiki"
  },
  "emotional_analysis": {
    "feedback": "Frustasi itu normal ketika trading tidak sesuai harapan.",
    "tip": "Istirahat dulu, minum kopi, tarik napas. Trading dengan emosi negatif berbahaya."
  },
  "risk_management_score": 5,
  "recommendations": [
    "💡 **Tips Hari Ini:**",
    "- Loss adalah guru terbaik. Apa yang bisa dipelajari?",
    "- Cek lagi: apakah analisis teknikal sudah benar?",
    "- Jangan revenge trading! Istirahat dulu jika perlu."
  ],
  "motivation_message": "Ini pelajaran berharga. Trader terbaik Indonesia juga pernah mengalami ini. 💪\n\n💡 **Pencapaian Anda:** Demo account $4,649.94 profit bukan main-main! Ini bukti Anda sudah paham konsep trading."
}
```

In this case, the AI mentor reframes losses as learning opportunities, providing emotional support while encouraging self-reflection and improvement.

### Example 3: Dashboard Integration
The `get_recent_mentor_reports()` function demonstrates how the table is used to provide summary information for the dashboard:

```python
def get_recent_mentor_reports(limit: int = 7) -> List[Dict[str, Any]]:
    """Ambil laporan mentor AI terbaru"""
    try:
        with sqlite3.connect('bots.db') as conn:
            cursor = conn.cursor()
            
            query = '''
                SELECT ts.session_date, ts.total_profit_loss, ts.total_trades,
                       ts.emotions, COALESCE(mr.motivation_message, 'Belum ada analisis AI') as motivation, mr.created_at
                FROM trading_sessions ts
                LEFT JOIN ai_mentor_reports mr ON ts.id = mr.session_id
                ORDER BY ts.session_date DESC
                LIMIT ?
            '''
            
            cursor.execute(query, (limit,))
            
            reports = []
            for row in cursor.fetchall():
                reports.append({
                    'session_date': row[0],
                    'profit_loss': row[1] if row[1] is not None else 0.0,
                    'total_trades': row[2] if row[2] is not None else 0,
                    'emotions': row[3] if row[3] else 'netral',
                    'motivation': row[4],
                    'created_at': row[5]
                })
            
            return reports
    except Exception as e:
        print(f"[AI MENTOR DB ERROR] Gagal ambil laporan terbaru: {e}")
        return []
```

This function performs a LEFT JOIN between `trading_sessions` and `ai_mentor_reports`, ensuring that all recent sessions are displayed on the dashboard even if no AI report has been generated yet. The `COALESCE` function provides a default message when no report exists, maintaining a consistent user experience.

**Section sources**
- [models.py](file://core/db/models.py#L176-L199)
- [models.py](file://core/db/models.py#L218-L260)
- [trading_mentor_ai.py](file://core/ai/trading_mentor_ai.py#L238-L304)

## Integration with Web Interface
The `ai_mentor_reports` table is tightly integrated with the web interface through Flask routes and HTML templates. This integration enables users to interact with their AI mentor reports through a user-friendly interface.

``mermaid
graph TB
A[HTML Templates] --> B(ai_mentor/dashboard.html)
A --> C(ai_mentor/daily_report.html)
A --> D(ai_mentor/history.html)
A --> E(ai_mentor/quick_feedback.html)
B --> F[Flask Routes]
C --> F
D --> F
E --> F
F --> G(ai_mentor.py)
G --> H[Database]
H --> I(ai_mentor_reports)
H --> J(trading_sessions)
H --> K(daily_trading_data)
I --> L[AI Analysis]
J --> L
K --> L
L --> G
```

**Diagram sources**
- [ai_mentor.py](file://core/routes/ai_mentor.py#L1-L332)
- [templates/ai_mentor/dashboard.html](file://templates/ai_mentor/dashboard.html)
- [templates/ai_mentor/daily_report.html](file://templates/ai_mentor/daily_report.html)

### Key Integration Points
**Dashboard Display**: The main dashboard (`dashboard.html`) shows a summary of recent AI mentor reports, including motivation messages and performance metrics. This provides users with a quick overview of their trading journey.

**Daily Report Page**: The `daily_report.html` template displays the complete AI-generated report in a formatted, visually appealing layout. This page includes all sections of the analysis: trading patterns, emotional impact, risk management, recommendations, and motivational messages.

**History Interface**: The `history.html` template allows users to browse past reports, enabling them to track their progress over time and identify long-term patterns in their trading behavior.

**Feedback Collection**: The `quick_feedback.html` template provides a modal interface for users to update their emotional state and personal notes, which are then stored in the `trading_sessions` table and used in future AI analysis.

The integration is facilitated by the `ai_mentor.py` routes, which handle HTTP requests, retrieve data from the database, generate AI analysis, and render the appropriate templates. This seamless integration ensures that users can easily access and benefit from the AI mentor's guidance.

**Section sources**
- [ai_mentor.py](file://core/routes/ai_mentor.py#L1-L332)
- [templates/ai_mentor/dashboard.html](file://templates/ai_mentor/dashboard.html)
- [templates/ai_mentor/daily_report.html](file://templates/ai_mentor/daily_report.html)